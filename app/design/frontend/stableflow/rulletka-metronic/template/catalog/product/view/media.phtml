<?php
/**
 * Created by nick
 * Project magento1.dev
 * Date: 6/16/17
 * Time: 1:46 PM
 */
?>
<?php
$_product = $this->getProduct();
$_helper = $this->helper('catalog/output');
?>
<script type="text/javascript" src="<?php echo $this->getSkinUrl('js/jquery.bxslider.js', array('_secure'=>true));?>"></script>
<script type="text/javascript" src="<?php echo $this->getSkinUrl('js/jquery.elevatezoom.js', array('_secure'=>true));?>"></script>
<link rel="stylesheet" href="<?php echo $this->getSkinUrl(); ?>css/jquery.bxslider.css" type="text/css" />

<div class="product-image product-image-zoom">
    <div class="product-image-gallery">
        <img id="image-main"
             class="gallery-image visible"
             src="<?php echo $this->helper('catalog/image')->init($_product, 'image')->resize(450) ?>"
             alt="<?php echo $this->escapeHtml($this->getImageLabel()) ?>"
             title="<?php echo $this->escapeHtml($this->getImageLabel()); ?>"
             data-zoom-image="<?php echo $this->helper('catalog/image')->init($_product, 'image') ?>"/>

        <script type="application/javascript">
            images = [];
            <?php $i=0; foreach ($this->getGalleryImages() as $_image): ?>
                <?php if ($this->isGalleryImageVisible($_image)): ?>
                    images[<?php echo $i?>] ="<?php echo $this->getGalleryImageUrl($_image); ?>";
                <?php endif; ?>
            <?php $i++; endforeach; ?>
        </script>
    </div>
</div>

<?php if (count($this->getGalleryImages()) > 0): ?>
    <div class="more-views" id="gallery_01">
        <ul class="product-image-thumbs bxslider-media">
            <?php $i=0; foreach ($this->getGalleryImages() as $_image): ?>
                <?php if ($this->isGalleryImageVisible($_image)): ?>
                    <li>
                        <a class="thumb-link" href="#" title="<?php echo $this->escapeHtml($_image->getLabel()) ?>" data-image-index="<?php echo $i; ?>"
                           data-image="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->resize(75); ?>"
                           data-zoom-image="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'image', $_image->getFile()); ?>">
                            <img src="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->resize(75); ?>"
                                 width="75" height="75" alt="<?php echo $this->escapeHtml($_image->getLabel()) ?>" />
                        </a>
                    </li>
                <?php endif; ?>
                <?php $i++; endforeach; ?>
        </ul>
    </div>
    <script>
        jQuery(document).ready(function(){
            jQuery('.bxslider-media').bxSlider({
                infiniteLoop: true,
                minSlides: 3,
                maxSlides: 4,
                slideWidth: 79,
                slideMargin: 10
            });
        });

    </script>
<?php endif; ?>

<?php echo $this->getChildHtml('after'); ?>


<?php //if (count($this->getGalleryImages()) > 3): ?>

<?php //endif;?>

<script type="application/javascript">
    //initiate the plugin and pass the id of the div containing gallery images
    jQuery("#image-main").elevateZoom({
        gallery:'gallery_01',
        cursor: 'pointer',
        galleryActiveClass: 'active',
        imageCrossfade: true,
        loadingIcon: 'http://www.elevateweb.co.uk/spinner.gif'
    });

    //pass the images to Fancybox
    jQuery("#image-main").bind("click", function(e) {
        var ez =   jQuery('#image-main').data('elevateZoom');
        jQuery.fancybox(ez.getGalleryList());
        return false;
    });
</script>
